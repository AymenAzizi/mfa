<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- MFA Verification Template -->
    <template id="mfa_verify_template" name="MFA Verification">
        <t t-call="web.login_layout">
            <t t-set="head">
                <style>
                    .mfa-container {
                        max-width: 400px;
                        margin: 0 auto;
                        padding: 20px;
                    }
                    .mfa-card {
                        background: white;
                        border-radius: 8px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        padding: 30px;
                    }
                    .mfa-header {
                        text-align: center;
                        margin-bottom: 30px;
                    }
                    .mfa-header h3 {
                        color: #333;
                        margin-bottom: 10px;
                    }
                    .mfa-form-group {
                        margin-bottom: 20px;
                    }
                    .mfa-form-control {
                        width: 100%;
                        padding: 12px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        font-size: 16px;
                        text-align: center;
                        letter-spacing: 2px;
                    }
                    .mfa-btn {
                        width: 100%;
                        padding: 12px;
                        background: #007bff;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        font-size: 16px;
                        cursor: pointer;
                        margin-bottom: 10px;
                    }
                    .mfa-btn:hover {
                        background: #0056b3;
                    }
                    .mfa-btn-secondary {
                        background: #6c757d;
                    }
                    .mfa-btn-secondary:hover {
                        background: #545b62;
                    }
                    .mfa-alert {
                        padding: 10px;
                        border-radius: 4px;
                        margin-bottom: 20px;
                    }
                    .mfa-alert-danger {
                        background: #f8d7da;
                        border: 1px solid #f5c6cb;
                        color: #721c24;
                    }
                    .mfa-alert-info {
                        background: #d1ecf1;
                        border: 1px solid #bee5eb;
                        color: #0c5460;
                    }
                    .mfa-tabs {
                        display: flex;
                        margin-bottom: 20px;
                        border-bottom: 1px solid #ddd;
                    }
                    .mfa-tab {
                        flex: 1;
                        padding: 10px;
                        text-align: center;
                        cursor: pointer;
                        background: #f8f9fa;
                        border: none;
                        border-bottom: 2px solid transparent;
                    }
                    .mfa-tab.active {
                        background: white;
                        border-bottom-color: #007bff;
                        color: #007bff;
                    }
                    .mfa-tab-content {
                        display: none;
                    }
                    .mfa-tab-content.active {
                        display: block;
                    }
                </style>
            </t>
            
            <div class="mfa-container">
                <div class="mfa-card">
                    <div class="mfa-header">
                        <h3>Multi-Factor Authentication</h3>
                        <p>Additional verification required for <strong t-esc="user.name"/></p>
                    </div>
                    
                    <t t-if="error">
                        <div class="mfa-alert mfa-alert-danger">
                            <t t-esc="error"/>
                        </div>
                    </t>
                    
                    <t t-if="success">
                        <div class="mfa-alert mfa-alert-info">
                            <t t-esc="success"/>
                        </div>
                    </t>
                    
                    <!-- Tab Navigation -->
                    <div class="mfa-tabs">
                        <button class="mfa-tab active" onclick="showTab('authenticator')">Authenticator App</button>
                        <button class="mfa-tab" onclick="showTab('backup')">Backup Code</button>
                    </div>
                    
                    <!-- Authenticator Tab -->
                    <div id="authenticator-tab" class="mfa-tab-content active">
                        <div class="mfa-alert mfa-alert-info">
                            Enter the 6-digit code from your authenticator app
                        </div>
                        
                        <form method="post" action="/web/mfa/verify/submit">
                            <div class="mfa-form-group">
                                <input type="text" 
                                       name="token" 
                                       class="mfa-form-control" 
                                       placeholder="000000" 
                                       maxlength="6" 
                                       pattern="[0-9]{6}"
                                       autocomplete="one-time-code"
                                       required="required"/>
                            </div>
                            <button type="submit" class="mfa-btn">Verify Code</button>
                        </form>
                    </div>
                    
                    <!-- Backup Code Tab -->
                    <div id="backup-tab" class="mfa-tab-content">
                        <div class="mfa-alert mfa-alert-info">
                            Enter one of your backup codes
                        </div>
                        
                        <form method="post" action="/web/mfa/verify/submit">
                            <div class="mfa-form-group">
                                <input type="text" 
                                       name="backup_code" 
                                       class="mfa-form-control" 
                                       placeholder="XXXXXXXX" 
                                       maxlength="8"
                                       style="text-transform: uppercase;"
                                       required="required"/>
                            </div>
                            <button type="submit" class="mfa-btn">Use Backup Code</button>
                        </form>
                    </div>
                    
                    <!-- Back to Login -->
                    <div style="text-align: center; margin-top: 20px;">
                        <a href="/web/login" class="mfa-btn mfa-btn-secondary" style="display: inline-block; text-decoration: none;">Back to Login</a>
                    </div>
                </div>
            </div>
            
            <script type="text/javascript">
                function showTab(tabName) {
                    // Hide all tab contents
                    var contents = document.querySelectorAll('.mfa-tab-content');
                    contents.forEach(function(content) {
                        content.classList.remove('active');
                    });
                    
                    // Remove active class from all tabs
                    var tabs = document.querySelectorAll('.mfa-tab');
                    tabs.forEach(function(tab) {
                        tab.classList.remove('active');
                    });
                    
                    // Show selected tab content
                    document.getElementById(tabName + '-tab').classList.add('active');
                    
                    // Add active class to clicked tab
                    event.target.classList.add('active');
                }
                
                // Auto-focus on the input field
                document.addEventListener('DOMContentLoaded', function() {
                    var activeInput = document.querySelector('.mfa-tab-content.active input');
                    if (activeInput) {
                        activeInput.focus();
                    }
                });
                
                // Auto-submit when 6 digits are entered for authenticator
                document.querySelector('input[name="token"]').addEventListener('input', function(e) {
                    if (e.target.value.length === 6 &amp;&amp; /^\d{6}$/.test(e.target.value)) {
                        e.target.form.submit();
                    }
                });
            </script>
        </t>
    </template>
</odoo>